---
title: Intellij IDEA Plugin DEV (ä¸‰)
date: 2019-03-12
categories:
  - Tools
tags: 
  - IDEA
---

::: tip
ä½¿ç”¨å®˜æ–¹æ¨èçš„ Gradle æ’ä»¶å¼€å‘
:::

<!-- more -->

## å‰è¨€

IDEA æ’ä»¶å¼€å‘åˆ†ä¸º 2 ç§æ–¹å¼:

1. ç›´æ¥ä½¿ç”¨ IDEA æä¾›çš„ `IntelliJ Platform Plugin`

![-w847](http://qiniu.dong4j.info/2019-07-03-15523673627848.jpg)

2. ä½¿ç”¨ Gradle

![-w803](http://qiniu.dong4j.info/2019-07-03-15523674481786.jpg)

å®˜æ–¹æ¨èä½¿ç”¨ Gradle æ–¹å¼, å› æ­¤é€‰ç”¨ç¬¬äºŒç§æ–¹å¼.

å› ä¸ºæœªä½¿ç”¨è¿‡ Gradle, è‚¯å®šä¼šé‡åˆ°å¾ˆå¤šå‘, ä¸ºäº†å‡å°‘å¤§å®¶çˆ¬å‘çš„æ—¶é—´, æˆ‘ä¼šå°½é‡æŠŠæ³¨é‡Šå†™è¯¦ç»†ç‚¹, å¦‚æœå‘ç°é”™è¯¯çš„åœ°æ–¹, è¯·å‘ŠçŸ¥æˆ‘.

## é…ç½®

ä½¿ç”¨ Gradle åˆ›å»ºå¥½æ’ä»¶é¡¹ç›®å, ç›´æ¥æ‹·è´ä»¥ä¸‹é…ç½®åˆ° `build.gradle`

```java
// mavenCentral() æ˜¯ä¸€ä¸ªæ’ä»¶ä»“åº“, å¯¼å…¥çš„æ’ä»¶å°†ä¼šåœ¨ä»“åº“ä¸­å¯»æ‰¾å¹¶ä¸‹è½½
buildscript {
    repositories {
        mavenCentral()
        maven { url "http://maven.aliyun.com/nexus/content/groups/public/" }
        maven { url "https://oss.sonatype.org/content/repositories/snapshots/" }
        maven { url 'http://dl.bintray.com/jetbrains/intellij-plugin-service' }
    }
}

plugins {
    id 'org.jetbrains.intellij' version '0.4.4'
}

repositories {
    mavenCentral()
}

tasks.withType(JavaCompile) {
    options.encoding = "UTF-8"
}

// å¯¼å…¥æ’ä»¶
// 1. ç¼–è¯‘, æµ‹è¯•æ’ä»¶ (Java, Groovy,Scala, War ç­‰)
// 2. ä»£ç åˆ†ææ’ä»¶ (Checkstyle, FindBugs, Sonar ç­‰)
// 3. IDE æ’ä»¶ (Eclipse, IDEA ç­‰)
// Java æ˜¯Gradleçš„æ ¸å¿ƒæ’ä»¶, æ˜¯å†…ç½®çš„, å†…ç½®æ’ä»¶ä¸éœ€è¦é…ç½®ä¾èµ–è·¯å¾„
apply plugin: 'java'
apply plugin: 'idea'
apply plugin: 'org.jetbrains.intellij'

sourceCompatibility = 1.8

intellij {
    version '2018.3.5'
    sandboxDirectory = project.rootDir.canonicalPath + "/.sandbox" //æ’ä»¶ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶çš„åœ°å€ï¼Œå¯ä»¥çœç•¥
}

// å£°æ˜ä¾èµ–ä½¿ç”¨ä¸‹é¢çš„é—­åŒ…
dependencies {
    // è§£å†³ gradle ä½¿ç”¨ lombok çš„é—®é¢˜
    annotationProcessor 'org.projectlombok:lombok:1.18.2'
    compileOnly 'org.projectlombok:lombok:1.18.2'
    testAnnotationProcessor 'org.projectlombok:lombok:1.18.2'
    testCompileOnly 'org.projectlombok:lombok:1.18.2'
    // å•å…ƒæµ‹è¯•
    testCompile group: 'junit', name: 'junit' , version: '4.12'
}
```

**å‘1:**

`lombok` ç”¨ä¹ æƒ¯äº†, å› æ­¤è¿™é‡Œä¹Ÿä½¿ç”¨äº†. 
ä½†æ˜¯æœ‰ä¸ªå‘, å¿…é¡»æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼ä¾èµ– `lombok`, ä¸ç„¶ä¼šæŠ¥æ‰¾ä¸åˆ°ç¬¦å·çš„é”™è¯¯, è¿˜æœ‰ç¬¬äºŒç§é…ç½®æ–¹å¼:

```java
repositories {
    mavenCentral()
}

plugins {
    id 'net.ltgt.apt' version '0.10'
}

dependencies {
    compileOnly 'org.projectlombok:lombok:1.18.2'
    apt "org.projectlombok:lombok:1.18.2"
}
```

é€‰æ‹©å…¶ä¸­ä¸€ç§å³å¯.

**å‘2:**

ä¹ æƒ¯åœ¨é¡¹ç›®ä¸­ä½¿ç”¨æ—¥å¿—ä»£æ›¿ `System.out.println();` æ‰“å°æ—¥å¿—, å› æ­¤è€ƒè™‘åœ¨æ­¤é¡¹ç›®ä½¿ç”¨ `slf4j2 + log4j2` æ—¥å¿—æ¡†æ¶, ä½†æ˜¯å´å¤±è´¥äº†. 

æ·»åŠ  `slf4j2 + log4j2` ä¾èµ–

```java
compile group: 'org.apache.logging.log4j', name: 'log4j-slf4j-impl', version: '2.11.0'
compile group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.11.0'
compile group: 'com.lmax', name: 'disruptor', version: '3.4.2'
```

é”™è¯¯ä¿¡æ¯:

```
SLF4J: No SLF4J providers were found.
SLF4J: Defaulting to no-operation (NOP) logger implementation
SLF4J: See http://www.slf4j.org/codes.html#noProviders for further details.
SLF4J: Class path contains SLF4J bindings targeting slf4j-api versions prior to 1.8.
```

è¿™æ˜¯ç”±äº `slf4j-api` 1.8.x çš„ç»‘å®šæœºåˆ¶çš„å˜åŒ–å¯¼è‡´, æ„æ€å°±æ˜¯ç‰ˆæœ¬å¤ªé«˜äº†, è¿™é‡Œä¿®æ”¹ä¸º 1.7.x ç‰ˆæœ¬å¯ä»¥æ¶ˆé™¤è¿™ä¸ªé”™è¯¯. è”ç³»ä¸€ä¸‹ gradle æ€ä¹ˆæ’é™¤ä¾èµ–

```java
compile (group: 'org.apache.logging.log4j', name: 'log4j-slf4j-impl', version: '2.11.0') {
    // æ’é™¤é«˜ç‰ˆæœ¬ä¾èµ–
    exclude group: 'org.slf4j', module: 'slf4j-api'
}
// ä½¿ç”¨ä½ç‰ˆæœ¬
compile group: 'org.slf4j', name: 'slf4j-api', version: '1.7.25'
```

è¿˜æ²¡è§£å†³å®Œ:

```
SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding in [jar:file:/Users/dong4j/Develop/codes/idea-plugin/aliyun-oss-upload/.sandbox/plugins/aliyun-oss-upload/lib/log4j-slf4j-impl-2.11.0.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: Found binding in [jar:file:/Users/dong4j/.gradle/caches/modules-2/files-2.1/com.jetbrains.intellij.idea/ideaIC/2018.3.5/2465ddbc4af3619128cada78e216ffbb93e8b173/ideaIC-2018.3.5/lib/slf4j-log4j12-1.7.25.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
```

åŸæ¥ IntelliJ IDEA SDK å·²ç»æœ‰äº† `slf4j-log4j12`, å› æ­¤æˆ‘ä»¬å¯ä»¥ä¸ç”¨é…ç½®äº†....ğŸ˜‚ (æåŠå¤©, æ˜¯è‡ªå·±ç»™è‡ªå·±æŒ–å‘).

å› æ­¤æœ€ç»ˆçš„é…ç½®å°±æ˜¯æœ€ä¸Šé¢ç»™å‡ºçš„é‚£ç§, å¦‚æœå¯¹ gradle ä¸ç†Ÿ, åˆæƒ³å¿«é€Ÿä¸Šæ‰‹çš„, ç›´æ¥å¤åˆ¶å°±å¯ä»¥äº†, å…ˆä¸å»æŠ˜è…¾ gradle çš„é…ç½®äº†, ä¸ç„¶å¼€å‘ idea æ’ä»¶çš„çƒ­æƒ…å°±ä¼šåœ¨ä¸æ–­çš„å¡«å‘è¿‡ç¨‹ä¸­æ…¢æ…¢æ•£å»....

**ä¸‹è½½ intellij SDK å¾ˆæ…¢, å‡†å¤‡å¥½æ¢¯å­å§**

## Hello world

```
äººä¹‹åˆ, æ€§æœ¬å–„;
å†™ä»£ç , hello world.
```

### AnAction

`AnAction` æ˜¯ä»€ä¹ˆå…ˆä¸ç®¡, ä¸å°±æŠŠå®ƒç†è§£æˆ JavaScript é‡Œé¢çš„ `onclick` äº‹ä»¶å¤„ç†å§

```java
@Slf4j
public class HelloAction extends AnAction {
    public HelloAction() {
        super("Hello");
    }

    /**
     * å“åº”ç”¨æˆ·çš„ç‚¹å‡»äº‹ä»¶
     *
     * @param event the event
     */
    @Override
    public void actionPerformed(@NotNull AnActionEvent event) {
        log.info(event.toString());
        Project project = event.getProject();
        Messages.showMessageDialog(project,
                                   "Hello world!",
                                   "Greeting",
                                   Messages.getInformationIcon());
    }
}
```

å†æ¥ä¸€ä¸ª

```java
public class AliyunOssUpload extends AnAction {

    @Override
    public void actionPerformed(@NotNull AnActionEvent actionEvent) {
        // è·å–å½“å‰åœ¨æ“ä½œçš„å·¥ç¨‹ä¸Šä¸‹æ–‡
        Project project1 = actionEvent.getProject();
        // è·å–å½“å‰æ“ä½œçš„ç±»æ–‡ä»¶
        PsiFile psiFile = actionEvent.getData(CommonDataKeys.PSI_FILE);
        // è·å–å½“å‰ç±»æ–‡ä»¶è·¯å¾„
        String classPath = "";
        if (psiFile != null) {
            classPath = psiFile.getVirtualFile().getPath();
        }
        String title = "hello world";

        // æ˜¾ç¤ºå¯¹è¯æ¡†
        Messages.showMessageDialog(project1, classPath, title, Messages.getInformationIcon());
    }
}
```

### æ³¨å†Œ

åœ¨ `plugin.xml` ä¸­æ³¨å†Œä¸Šé¢çš„ç±», å¯åŠ¨åä¼šé€šè¿‡åå°„æ¥è°ƒç”¨æˆ‘ä»¬çš„å¤„ç†é€»è¾‘.

```xml
<idea-plugin>
    <!-- æ’ä»¶åŸºæœ¬ä¿¡æ¯ -->
    <id>info.dong4j.aliyun-oss-upload</id>
    <name>Aliyun OSS upload</name>
    <version>0.0.1</version>
    <vendor email="dong4j@gmail.com" url="http://www.dong4j.info">dong4j</vendor>

    <depends>com.intellij.modules.lang</depends>
    <description>
        Aliyun OSS upload, xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
    </description>

    <!-- please see http://www.jetbrains.org/intellij/sdk/docs/basics/getting_started/plugin_compatibility.html
         on how to target different products -->
    <!-- uncomment to enable plugin in all products
    <depends>com.intellij.modules.lang</depends>
    -->

    <!-- æ’ä»¶æ‰©å±•æ ‡ç­¾ -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- Add your extensions here -->
        <applicationService serviceInterface="info.dong4j.test.HelloApplicationText"
                            serviceImplementation="info.dong4j.test.impl.HelloApplicationTextImpl"/>
    </extensions>

    <!-- action æ³¨å†Œæ ‡ç­¾ -->
    <actions>
        <!-- åˆ›å»ºä¸€ä¸ªæ–°çš„ group, ä¹Ÿå¯ä»¥æ·»åŠ åˆ°å·²æœ‰çš„ group ä¸Š -->
        <group id="MyPlugin.SampleMenu" text="Greeting" description="Greeting menu">
            <!-- æ·»åŠ åˆ° MainMenu group ä¸‹, ä½ç½®ä¸º `last` -->
            <add-to-group group-id="MainMenu" anchor="last"/>
            <!-- id å”¯ä¸€, class å°±æ˜¯æˆ‘ä»¬çš„å¤„ç†ç±» -->
            <action id="Myplugin.Textboxes" class="info.dong4j.test.HelloAction" text="Hello"  description="Says hello" />
        </group>
        <!-- å¦ä¸€ä¸ª action -->
        <action id="info.dong4j.aliyun-oss-upload" class="info.dong4j.test.AliyunOssUpload" text="upload aliyun oss"
                description="ä¸Šä¼ æ–‡ä»¶åˆ° aliyun OSS">
            <!-- æ·»åŠ åˆ° GenerateGroup group ä¸‹, ä½ç½®ä¸º `last` -->
            <add-to-group group-id="GenerateGroup" anchor="last"/>
        </action>
    </actions>
</idea-plugin>
```

### è¿è¡Œ

![-w525](http://qiniu.dong4j.info/2019-07-03-15523704879363.jpg)
### æ•ˆæœ

![-w421](http://qiniu.dong4j.info/2019-07-03-15523705480816.jpg)

ç‚¹å‡» 'Hello' ä¹‹å:

![-w456](http://qiniu.dong4j.info/2019-07-03-15523705697461.jpg)

## æ€»ç»“

å…¥é—¨å¾ˆå¿«, å› æ­¤å†™å¾—ä¸æ˜¯éå¸¸è¯¦ç»†, å› ä¸ºå…¥é—¨ç›¸å…³çš„æ•™ç¨‹å·²ç»éå¸¸å¤šäº†, å¯å‚è§ [ğŸ‘‰ å®˜æ–¹å…¥é—¨æ•™ç¨‹](https://www.jetbrains.org/intellij/sdk/docs/basics/getting_started.html).

è¿˜æœ‰å¾ˆå¤šæ‰‹æŠŠæ‰‹æ•™çš„å…¥é—¨æ•™ç¨‹, ä¸€æœä¸€å¤§æŠŠ, å› æ­¤æ­¤ç³»åˆ—æ–‡ç« åªä¼šè®°å½•å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œç»éªŒæ€»ç»“.

ä¸ºäº†å¤§å®¶å¿«é€Ÿå…¥æ‰‹, è¿™é‡Œç»™å‡ºæ­¤é¡¹ç›®çš„ [ğŸ‘‰ github åœ°å€](), æ„¿æœ‰ç¼˜äººèµ¶ç´§å…¥å‘, ä¸€èµ·æ¥å­¦ä¹ å¼€å‘ idea æ’ä»¶.

å‘Šè¯‰ä½ ä¸€ä¸ªå¥½æ¶ˆæ¯, Intellij idea å¼€å¯äº†ä¸€ä¸ªæ’ä»¶æ”¶è´¹å¹³å°, æ¥è®©æ›´å¤šçš„æ’ä»¶å¼€å‘ä¸­ä»ä¸­è·åˆ©.

![-w1444](http://qiniu.dong4j.info/2019-07-03-15523714206616.jpg)

è¯¦æƒ…å¯è§ [ğŸ‘‰ Marketplace](https://plugins.jetbrains.com/marketplace)

æ­¤ç¯‡æ–‡æ¡£æ¶‰åŠåˆ°çš„å…¨éƒ¨ä»£ç è¯·çœ‹ [ğŸ‘‰ Github](https://github.com/dong4j/aliyun-oss-upload/tree/1.hello-world). ç»™ä¸ª star å‘—.

