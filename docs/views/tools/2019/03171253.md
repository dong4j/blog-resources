---
title: Intellij IDEA Plugin DEV (ä¸ƒ)
date: 2019-03-17
categories:
  - Tools
tags: 
  - IDEA
---

::: tip
ä»‹ç»IDEA Plugin å¼€å‘å…¥å£
:::

<!-- more -->

æ¥ä¸‹çš„æ–‡æ¡£éƒ½ä¼šæ ¹æ®å‰ä¸€ç¯‡çš„éœ€æ±‚æ¥æ‰¾åˆ°è§£å†³æ–¹æ¡ˆ, å¯¹äºä¸ç†Ÿæ‚‰ IDEA æ’ä»¶å¼€å‘çš„åŒå­¦(è¯´çš„å°±æ˜¯æˆ‘), å¯èƒ½ä¸€æ—¶æ‰¾ä¸åˆ°å„ä¸ªå…¬å…±çš„å…¥å£, è¿™ä¸ªæ˜¯å¦å°±è¦çœ‹ä¸€äº›å¼€æºçš„æ’ä»¶, ä»ä¸­æ‰¾åˆ°åŠŸèƒ½å…¥å£.

## å³é”®èœå•å…¥å£

éœ€æ±‚ä¸­æåˆ° **ã€Œåœ¨ç¼–è¾‘è§†å›¾ä¸­ç›´æ¥å³é”® --> `upload to Aliyun OSS`ã€**

å› æ­¤æˆ‘ä»¬éœ€è¦æ‰©å±•å³é”®èœå•, æ¥æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„åŠŸèƒ½å…¥å£.

ç°åœ¨ä»‹ç»ä¸€ç§æ–°çš„æ·»åŠ  AnAction çš„æ–¹å¼:

![-w373](http://qiniu.dong4j.info/2019-07-03-15523815700090.jpg)
![-w966](http://qiniu.dong4j.info/2019-07-03-15523815861679.jpg)

è¿™ä¹ˆå¤š Group. å¥½äº†, æ‡µé€¼äº†....

é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ¥æ‰¾æˆ‘ä»¬éœ€è¦çš„ Group å‘¢?
æˆ‘è¿™é‡Œç”¨ä¸ªç¬¨åŠæ³•, çœ‹åˆ«äººçš„æ’ä»¶é…ç½®å‘—, è¿™é‡Œé€šè¿‡çœ‹ `Alibaba Java Coding Guidelines` è¿™ä¸ªæ’ä»¶çš„é…ç½®, å¯ä»¥ç¡®å®šçš„æœ‰:

**MainToolBar**

![-w552](http://qiniu.dong4j.info/2019-07-03-15523820635184.jpg)

**ProjectViewPopupMenu**

![-w614](http://qiniu.dong4j.info/2019-07-03-15523821420332.jpg)

**ChangesViewPopupMenu**

![-w629](http://qiniu.dong4j.info/2019-07-03-15523821792560.jpg)

**EditorPopupMenu**

![-w592](http://qiniu.dong4j.info/2019-07-03-15523822024307.jpg)

å…ˆæ¥ç¬¬ä¸€ä¸ª, åœ¨ç¼–è¾‘å™¨å³é”®èœå•ä¸­æ·»åŠ æˆ‘ä»¬çš„ action, å¾ˆæ˜æ˜¾æ˜¯ç”¨ `EditorPopupMenu`

```xml
<action id="info.dong4j.aliyun-oss-upload" class="info.dong4j.test.AliyunOssUpload" text="upload aliyun oss"
        description="ä¸Šä¼ æ–‡ä»¶åˆ° aliyun OSS">
    <add-to-group group-id="GenerateGroup" anchor="last"/>
</action>

<action id="AliObjectStorageServiceAction" class="info.dong4j.idea.plugin.action.AliObjectStorageServiceAction"
        popup="true" text="upload to Aliyun OSS">
    <add-to-group group-id="MainToolBar" anchor="last"/>
    <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
    <add-to-group group-id="ChangesViewPopupMenu" anchor="last"/>
    <add-to-group group-id="EditorPopupMenu" anchor="last"/>
</action>

<group popup="true" id="com.alibaba.p3c.analytics.action_group" text="Aliyun OSS">
    <reference ref="AliObjectStorageServiceAction"/>
    <add-to-group group-id="ToolsMenu" anchor="last"/>
</group>
```

ä¸å‡ºæ„å¤–çš„è¯:

**MainToolBar**

![-w483](http://qiniu.dong4j.info/2019-07-03-15523834279655.jpg)


**ProjectViewPopupMenu**

![-w617](http://qiniu.dong4j.info/2019-07-03-15523834661548.jpg)
**ChangesViewPopupMenu**

![-w546](http://qiniu.dong4j.info/2019-07-03-15523835520352.jpg)

**EditorPopupMenu**

![-w477](http://qiniu.dong4j.info/2019-07-03-15523835769361.jpg)

## åŠŸèƒ½å®ç°

ç”±äºéœ€æ±‚å®ç°ä¸æ˜¯æœ¬æ•™ç¨‹çš„é‡ç‚¹, æ‰€ä»¥ä¼šé€‰å–æ’ä»¶å¼€å‘æœ‰å…³çš„é—®é¢˜ä½œå‡ºè¯´æ˜.

### æ€ä¹ˆåˆ¤æ–­é€‰ä¸­çš„å¯¹è±¡æ˜¯ Markdown æ–‡ä»¶

é¦–å…ˆæˆ‘ä»¬å¾—çŸ¥é“å½“å‰å…‰æ ‡é€‰ä¸­çš„æ˜¯ä»€ä¹ˆä¸œè¥¿

```java
// è·å–å½“å‰æ“ä½œçš„æ–‡ä»¶
PsiFile psiFile = anActionEvent.getData(CommonDataKeys.PSI_FILE);
if (psiFile != null) {
    log.info("language = {}", psiFile.getOriginalFile().getLanguage());
    log.info("name = {}", psiFile.getOriginalFile().getName());
    Messages.showMessageDialog(project, psiFile.getFileType().getName(), "File Type", null);
}
//è·å–å½“å‰äº‹ä»¶è§¦å‘æ—¶ï¼Œå…‰æ ‡æ‰€åœ¨çš„å…ƒç´ 
PsiElement psiElement = anActionEvent.getData(LangDataKeys.PSI_ELEMENT);
//å¦‚æœå…‰æ ‡é€‰æ‹©çš„ä¸æ˜¯ç±»ï¼Œå¼¹å‡ºå¯¹è¯æ¡†æé†’
if (psiElement == null || !(psiElement instanceof PsiClass)) {
    Messages.showMessageDialog(project, "Please focus on a class", "Generate Failed", null);
    return;
}
```   

```
2019-03-12 18:16:00,899 [  44799]   INFO - .AliObjectStorageServiceAction - language = Language: JAVA 
2019-03-12 18:16:00,899 [  44799]   INFO - .AliObjectStorageServiceAction - name = HelloOSS.java 
2019-03-12 18:16:10,423 [  54323]   INFO - .AliObjectStorageServiceAction - project's base path = /Users/dong4j/Develop/codes/alibaba/aliyun-oss-java-sdk-demo-mvn 
2019-03-12 18:16:14,372 [  58272]   INFO - .AliObjectStorageServiceAction - language = Language: TEXT 
2019-03-12 18:16:14,372 [  58272]   INFO - .AliObjectStorageServiceAction - name = maven-demo.iml 
2019-03-12 18:18:06,392 [ 170292]   INFO - .AliObjectStorageServiceAction - language = Language: TEXT 
2019-03-12 18:18:06,392 [ 170292]   INFO - .AliObjectStorageServiceAction - name = 3-2-data-grip.md 
2019-03-12 18:18:08,586 [ 172486]   INFO - .AliObjectStorageServiceAction - project's base path = /Users/dong4j/Develop/knowledge 
``` 

psiFile è¿˜æœ‰å…¶ä»–çš„ä¸€äº›å±æ€§, è¿™ä¸ªå°± debug çœ‹å§.

ä»ä¸Šé¢æˆ‘ä»¬çŸ¥é“äº†, å¦‚æœæ˜¯ `Markdown` æ–‡ä»¶, Language ä¸º TEXT, name æ˜¯æ–‡ä»¶å.
å¦‚æœæ˜¯ç±»æ–‡ä»¶, åˆ™æ˜¯ JAVA. å¯ä»¥ä½¿ç”¨ `PsiJavaFile` æ¥æ“ä½œ.

![-w544](http://qiniu.dong4j.info/2019-07-03-15523863788511.jpg)

![EBE0BC3B-E84A-4FFC-BBF0-E554EA451](http://qiniu.dong4j.info/2019-07-03-EBE0BC3B-E84A-4FFC-BBF0-E554EA451C93.png)

### è·å– Markdown æ–‡ä»¶çš„æ‰€æœ‰å†…å®¹

```java
String text = Objects.requireNonNull(psiFile.getViewProvider().getDocument()).getText();
```

![-w456](http://qiniu.dong4j.info/2019-07-03-15523882324191.jpg)

## update

[ğŸ‘‰ åˆ¤æ–­æŒ‰é’®ä»€ä¹ˆæ—¶å€™å¯ç”¨](https://github.com/dong4j/aliyun-oss-upload/tree/2.update)


